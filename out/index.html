<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Component js JCO</title>
    <base href="." />
  </head>
  <body>
    <script type="module">
      class MyCompany {
        constructor(name, maxSalary) {
          this.name = name;
          this.maxSalary = maxSalary;
        }

        getName() {
          return this.name;
        }

        setName(name) {
          this.name = name;
        }

        getMaxSalary() {
          return this.maxSalary;
        }
      }

      import("./component.js").then(async (module) => {
        let instantiate = () =>
          module.instantiate(
            async (url, imports) => {
              let data = await fetch("./" + url);
              return WebAssembly.compile(await data.arrayBuffer(), imports);
            },
            {
              ["log"]: {
                default: console.log,
              },
              ["component-test:wit-protocol/companies"]: {
                Company: MyCompany,
              },
              ["component-test:wit-protocol/host-fns"]: {
                companyRoundtrip: (company) => {
                  company.name = `${company.name} trip`;
                  return company;
                },
              },
            }
          );

        let instance1 = await instantiate();
        console.log(
          instance1.guestFns.companyRoundtrip(
            new MyCompany("CompanyName", 10000)
          )
        );

        let employee = new instance1.employees.Employee("EmployeeName", 8000);
        console.log(employee, employee.getName());

        let returned = instance1.guestFns.employeeRoundtrip(employee);
        console.log(returned, returned.getName());
      });
    </script>
  </body>
</html>
