<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Wit runtime JCO</title>
    <base href="." />
  </head>
  <body>
    <script type="module">
      import("./out-dir/component.js").then(async (module) => {
        let instantiate = () =>
          module.instantiate(
            async (url, imports) => {
              let data = await fetch("out-dir/" + url);
              return WebAssembly.compile(await data.arrayBuffer(), imports);
            },
            {
              print: { default: console.log },
              ["import-point"]: {
                default: (point) => {
                  point.x += 100;
                  return point;
                },
              },
              ["example:protocol/host-imports"]: {
                printLine: console.log,
              },
              ["inline-imports"]: {
                addOne: (num) => num + 1,
              },
              // cSpell::disable-next-line
              singlewordimports: {
                subOne: (num) => num - 1,
              },
            }
          );

        let instance1 = await instantiate();
        console.log(instance1.movePoint({ x: 50, y: 50 }));

        instance1["example:protocol/guest-exports"].run();

        console.log(
          "5 + 3 =",
          // instance1["inline-exports"].addThree(5) TS bindings wrong again
          instance1.inlineExports.addThree(5)
        );

        console.log(
          "5 - 3 =",
          // cSpell::disable-next-line
          instance1.singlewordexports.subThree(5)
        );

        let instance2 = await instantiate();

        console.log("instance 1:", instance1.increment());
        console.log("instance 1:", instance1.increment());
        console.log("instance 2:", instance2.increment());
        console.log("instance 1:", instance1.increment());
        console.log("instance 2:", instance2.increment());
        console.log("instance 1:", instance1.increment());
      });
    </script>
  </body>
</html>
