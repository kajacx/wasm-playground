<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Wit runtime JCO</title>
    <base href="." />
  </head>
  <body>
    <script type="module">
      import("./out-dir/guest_exports.js").then(async (module) => {
        let instantiate = () =>
          module.instantiate(
            async (url, imports) => {
              let data = await fetch("out-dir/" + url);
              return WebAssembly.compile(await data.arrayBuffer(), imports);
            },
            {
              ["import-vector-round"]: {
                default: (vector) => {
                  return vector;
                },
              },
              ["import-vector-list"]: {
                default: (list) => {
                  return list;
                },
              },
              ["import-s32"]: {
                default: (s) => {
                  return s;
                },
              },
              ["import-string"]: {
                default: (s) => {
                  return s;
                },
              },
              ["import-insane"]: {
                default: (i) => {
                  i[0].x = 100;
                  return i;
                },
              },
            }
          );

        let instance1 = await instantiate();
        let vec = { x: 50, y: 60, z: 70 };
        console.log(instance1.exportVectorRound(vec));
        console.log(instance1.exportVectorList([vec, vec]));
        console.log(instance1.exportInsane([vec, vec, vec, vec, vec, vec]));
      });
    </script>
  </body>
</html>
