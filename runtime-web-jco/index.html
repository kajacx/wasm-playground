<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Wit runtime JCO</title>
    <base href="." />
  </head>
  <body>
    <script type="module">
      // fetch("./out-dir/component.js")
      //   .then((resp) => resp.text())
      //   .then(eval)
      //   .then(console.log)
      //   .catch(console.error);

      // if (Math.random() < 2) {
      //   import("./out-dir/component.js")
      //     //  .then((resp) => resp.text())
      //     //  .then(eval)
      //     .then(console.log)
      //     .catch(console.error);
      // }

      import("./out-dir/component.js").then((module) => {
        module
          .instantiate(
            async (url, imports) => {
              let data = await fetch("out-dir/" + url);
              return WebAssembly.compile(await data.arrayBuffer(), imports);
            },
            {
              print: { default: console.log },
              ["import-point"]: {
                default: (point) => {
                  point.x += 500;
                  return point;
                },
              },
            }
          )
          .then((instance) => {
            // alert(Reflect.get(instance, "movePoint"));
            instance.run();
            console.log(instance.movePoint({ x: 5, y: 15 }));
          });
      });
    </script>
  </body>
</html>
